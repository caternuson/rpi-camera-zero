<!doctype html>
<html>
<head>
  <link href={{ static_url("css/bootstrap.min.css") }} rel="stylesheet">
  <script src={{ static_url("js/jquery.min.js") }}></script>
  <script src={{ static_url("js/bootstrap.bundle.min.js") }}></script>
</head>
<body class="bd-docs">
<div class="container">
<p>RUNNING...</p>
<button id="tl_cancel" class="btn btn-danger">CANCEL</button>
<p id="tl_status">????</p>
</div>
</body>

<script>

ID_STA = setInterval(update, 1000)

$(document).ready(function () {
  $("#tl_cancel").click(function (event) {
      return cancel_timelapse();
  });
});

function cancel_timelapse() {
  if (window.confirm("CANCEL TIMELAPSE?")) {
    // $.ajax({
    //   url: "/ajax",
    //   type: "POST",
    //   dataType: "json",
    //   data: JSON.stringify({
    //     "CMD":"STO",
    //   }),
    // })
    // .done(function(json) {
    //   window.location.reload();
    // })
    ajax_cmd("STO")
    window.location.reload();
  }
  return false;
}

function update() {
  // resp = JSON.parse(ajax_cmd("TIM"))
  // $("#tl_status").text(resp["TIME"])
  $.ajax({
    url: "/",
    type: "POST",
    dataType: "json",
    data: JSON.stringify({
      "CMD":"TIM",
    }),
  })
  .done(function(data) {
    json = JSON.parse(data.responseText)
    alert(json)
  })
}

function ajax_cmd(command) {
  $.ajax({
    url: "/",
    type: "POST",
    dataType: "json",
    data: JSON.stringify({
      "CMD":command,
    }),
  })
  .done(function(json) {
    return json
  })
}
</script>
</html>